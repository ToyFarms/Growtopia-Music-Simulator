var Ke=Object.defineProperty;var tr=(t,s,n)=>s in t?Ke(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var g=(t,s,n)=>tr(t,typeof s!="symbol"?s+"":s,n);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const h of a)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const h={};return a.integrity&&(h.integrity=a.integrity),a.referrerPolicy&&(h.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?h.credentials="include":a.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function l(a){if(a.ep)return;a.ep=!0;const h=n(a);fetch(a.href,h)}})();var Dt=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,s=arguments.length;s--;)t+=arguments[s]*arguments[s];return Math.sqrt(t)});function Mt(){var t=new Dt(16);return Dt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function er(t,s){var n=s[0],l=s[1],a=s[2],h=s[3],d=s[4],T=s[5],p=s[6],f=s[7],E=s[8],O=s[9],P=s[10],N=s[11],C=s[12],_=s[13],m=s[14],D=s[15],I=n*T-l*d,q=n*p-a*d,y=n*f-h*d,J=l*p-a*T,X=l*f-h*T,G=a*f-h*p,$=E*_-O*C,F=E*m-P*C,W=E*D-N*C,w=O*m-P*_,z=O*D-N*_,K=P*D-N*m,A=I*K-q*z+y*w+J*W-X*F+G*$;return A?(A=1/A,t[0]=(T*K-p*z+f*w)*A,t[1]=(a*z-l*K-h*w)*A,t[2]=(_*G-m*X+D*J)*A,t[3]=(P*X-O*G-N*J)*A,t[4]=(p*W-d*K-f*F)*A,t[5]=(n*K-a*W+h*F)*A,t[6]=(m*y-C*G-D*q)*A,t[7]=(E*G-P*y+N*q)*A,t[8]=(d*z-T*W+f*$)*A,t[9]=(l*W-n*z-h*$)*A,t[10]=(C*X-_*y+D*I)*A,t[11]=(O*y-E*X-N*I)*A,t[12]=(T*F-d*w-p*$)*A,t[13]=(n*w-l*F+a*$)*A,t[14]=(_*q-C*J-m*I)*A,t[15]=(E*J-O*q+P*I)*A,t):null}function rr(t,s,n){var l=n[0],a=n[1],h=n[2],d,T,p,f,E,O,P,N,C,_,m,D;return s===t?(t[12]=s[0]*l+s[4]*a+s[8]*h+s[12],t[13]=s[1]*l+s[5]*a+s[9]*h+s[13],t[14]=s[2]*l+s[6]*a+s[10]*h+s[14],t[15]=s[3]*l+s[7]*a+s[11]*h+s[15]):(d=s[0],T=s[1],p=s[2],f=s[3],E=s[4],O=s[5],P=s[6],N=s[7],C=s[8],_=s[9],m=s[10],D=s[11],t[0]=d,t[1]=T,t[2]=p,t[3]=f,t[4]=E,t[5]=O,t[6]=P,t[7]=N,t[8]=C,t[9]=_,t[10]=m,t[11]=D,t[12]=d*l+E*a+C*h+s[12],t[13]=T*l+O*a+_*h+s[13],t[14]=p*l+P*a+m*h+s[14],t[15]=f*l+N*a+D*h+s[15]),t}function ir(t,s,n){var l=n[0],a=n[1],h=n[2];return t[0]=s[0]*l,t[1]=s[1]*l,t[2]=s[2]*l,t[3]=s[3]*l,t[4]=s[4]*a,t[5]=s[5]*a,t[6]=s[6]*a,t[7]=s[7]*a,t[8]=s[8]*h,t[9]=s[9]*h,t[10]=s[10]*h,t[11]=s[11]*h,t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],t}function sr(t,s,n){var l=Math.sin(n),a=Math.cos(n),h=s[0],d=s[1],T=s[2],p=s[3],f=s[4],E=s[5],O=s[6],P=s[7];return s!==t&&(t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15]),t[0]=h*a+f*l,t[1]=d*a+E*l,t[2]=T*a+O*l,t[3]=p*a+P*l,t[4]=f*a-h*l,t[5]=E*a-d*l,t[6]=O*a-T*l,t[7]=P*a-p*l,t}function nr(t,s,n,l,a,h,d){var T=1/(s-n),p=1/(l-a),f=1/(h-d);return t[0]=-2*T,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(s+n)*T,t[13]=(a+l)*p,t[14]=(d+h)*f,t[15]=1,t}var or=nr;function pe(){var t=new Dt(3);return Dt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ar(t,s,n){var l=s[0],a=s[1],h=s[2],d=n[3]*l+n[7]*a+n[11]*h+n[15];return d=d||1,t[0]=(n[0]*l+n[4]*a+n[8]*h+n[12])/d,t[1]=(n[1]*l+n[5]*a+n[9]*h+n[13])/d,t[2]=(n[2]*l+n[6]*a+n[10]*h+n[14])/d,t}(function(){var t=pe();return function(s,n,l,a,h,d){var T,p;for(n||(n=3),l||(l=0),a?p=Math.min(a*n+l,s.length):p=s.length,T=l;T<p;T+=n)t[0]=s[T],t[1]=s[T+1],t[2]=s[T+2],h(t,t,d),s[T]=t[0],s[T+1]=t[1],s[T+2]=t[2];return s}})();const hr=t=>{const s=new Date,n={yyyy:s.getFullYear(),MM:String(s.getMonth()+1).padStart(2,"0"),dd:String(s.getDate()).padStart(2,"0"),HH:String(s.getHours()).padStart(2,"0"),mm:String(s.getMinutes()).padStart(2,"0"),ss:String(s.getSeconds()).padStart(2,"0"),M:s.getMonth()+1,d:s.getDate(),H:s.getHours(),m:s.getMinutes(),s:s.getSeconds(),a:s.getHours()<12?"AM":"PM"};return t.replace(/yyyy|MM|dd|HH|mm|ss|M|d|H|m|s|a/g,l=>n[l].toString())},fe=(t,s)=>{const n=Mt();er(n,t.projection_matrix);const l=[s[0]/t.width*2-1,1-s[1]/t.height*2,0],a=pe();return ar(a,l,n),[a[0],a[1]]},Q=document.querySelector("#console"),cr=(t,s)=>{const n=document.createElement("p");n.textContent=`[${hr("dd-mm-yyyy s:m:H")}] ${t}`,n.style.color=s,n.classList.add("console-text"),Q==null||Q.appendChild(n),Q==null||Q.classList.remove("hide"),setTimeout(()=>{Q==null||Q.classList.add("hide")},1e3*10)},it=t=>{cr(`[ ERROR ] ${t}`,"red")};let mt;const Bt=document.querySelector("#app"),de=Bt==null?void 0:Bt.querySelector("canvas"),Vt=()=>{if(mt)return mt;if(!de)throw it("Could not find canvas element"),new Error("opengl_context() error");if(mt=de.getContext("webgl2"),!mt)throw it("WebGl is not supported in this device"),new Error("opengl_context() error");return mt};class Te{constructor(){g(this,"gl");this.gl=Vt()}}class Ee extends Te{constructor(){super();g(this,"id");this.id=0}}var Ut=(t=>(t[t.FRAGMENT=0]="FRAGMENT",t[t.VERTEX=1]="VERTEX",t))(Ut||{});const lr=(t,s)=>{const n=Vt(),l=[n.FRAGMENT_SHADER,n.VERTEX_SHADER],a=n.createShader(l[s]);if(!a)return it(`Failed to create shader type ${s}`),null;if(n.shaderSource(a,t),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS)){const h=n.getShaderInfoLog(a);if(h)return it(`Failed to compile shader type ${Ut[s]}: ${h}`),null}return a};class ur extends Ee{constructor(n){super();g(this,"shaders");g(this,"program");this.shaders=n;const l=this.gl.createProgram();if(!l)throw it("Cannot create program"),new Error;this.program=l,this.process_shaders(n)}bind(){this.gl.useProgram(this.program)}unbind(){this.gl.useProgram(null)}delete(){this.gl.deleteProgram(this.program)}get_uniform(n){const l=this.gl.getUniformLocation(this.program,n);if(!l)throw it(`Could not get uniform "${n}"`),new Error;return l}link(){if(this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)){const n=this.gl.getProgramInfoLog(this.program);if(n){it(`Failed to link shader: ${n}`);return}}}process_shaders(n){for(const l of n){const a=lr(l.source,l.type);if(!a)throw new Error;this.gl.attachShader(this.program,a),this.gl.deleteShader(a)}this.link()}}const fr=`#version 300 es
precision mediump float;

in vec2 v_texcoord;
out vec4 frag_color;

uniform sampler2D tex;

void main()
{
  frag_color = texture(tex, v_texcoord);
}
`,dr=`#version 300 es
precision mediump float;

layout (location = 0) in vec2 position;
layout (location = 1) in vec2 offset;
layout (location = 2) in vec2 scale;
layout (location = 3) in vec4 texcoord;
layout (location = 4) in float rotation;

uniform mat4 projection;

out vec2 v_texcoord;

void main()
{
  float cos_rot = cos(rotation);
  float sin_rot = sin(rotation);

  mat2 rot_matrix = mat2(
    cos_rot, -sin_rot,
    sin_rot, cos_rot
  );

  vec2 rotated_scaled = rot_matrix * (position * scale);

  gl_Position = projection * vec4(rotated_scaled + offset, 0.0, 1.0);
  v_texcoord = mix(texcoord.xy, texcoord.zw, position + 0.5);
}
`,rt=class rt extends Te{constructor(n,l,a,h){super();g(this,"pos");g(this,"size");g(this,"texcoord");g(this,"rotation");this.pos=n,this.size=l,this.texcoord=a,this.rotation=h||0}get_model_matrix(){const n=Mt();return rr(n,n,[this.pos[0],this.pos[1],0]),ir(n,n,[this.size[0],this.size[1],0]),sr(n,n,this.rotation*(Math.PI/180)),n}static setup_instanced_attributes(n,l){const h=new Float32Array(l.length*9),d=Float32Array.BYTES_PER_ELEMENT;l.forEach((f,E)=>{h[E*9+0]=f.pos[0],h[E*9+1]=f.pos[1],h[E*9+2]=f.size[0],h[E*9+3]=f.size[1],h[E*9+4]=f.texcoord[0],h[E*9+5]=f.texcoord[1],h[E*9+6]=f.texcoord[2],h[E*9+7]=f.texcoord[3],h[E*9+8]=f.rotation*(Math.PI/180)});const T=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,T),n.bufferData(n.ARRAY_BUFFER,h,n.STATIC_DRAW);const p=9*d;n.vertexAttribPointer(1,2,n.FLOAT,!1,p,0),n.enableVertexAttribArray(1),n.vertexAttribDivisor(1,1),n.vertexAttribPointer(2,2,n.FLOAT,!1,p,2*d),n.enableVertexAttribArray(2),n.vertexAttribDivisor(2,1),n.vertexAttribPointer(3,4,n.FLOAT,!1,p,4*d),n.enableVertexAttribArray(3),n.vertexAttribDivisor(3,1),n.vertexAttribPointer(4,1,n.FLOAT,!1,p,8*d),n.enableVertexAttribArray(4),n.vertexAttribDivisor(4,1)}};g(rt,"vertices",new Float32Array([-.5,.5,.5,.5,-.5,-.5,.5,-.5])),g(rt,"indices",new Uint16Array([0,1,2,2,1,3])),g(rt,"vertex_count",rt.vertices.length/2),g(rt,"index_count",rt.indices.length);let at=rt;var vr={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(s,n,l,a){var h=["","webkit","Moz","MS","ms","o"],d=n.createElement("div"),T="function",p=Math.round,f=Math.abs,E=Date.now;function O(e,r,i){return setTimeout(q(e,i),r)}function P(e,r,i){return Array.isArray(e)?(N(e,i[r],i),!0):!1}function N(e,r,i){var o;if(e)if(e.forEach)e.forEach(r,i);else if(e.length!==a)for(o=0;o<e.length;)r.call(i,e[o],o,e),o++;else for(o in e)e.hasOwnProperty(o)&&r.call(i,e[o],o,e)}function C(e,r,i){var o="DEPRECATED METHOD: "+r+`
`+i+` AT 
`;return function(){var c=new Error("get-stack-trace"),u=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",v=s.console&&(s.console.warn||s.console.log);return v&&v.call(s.console,o,u),e.apply(this,arguments)}}var _;typeof Object.assign!="function"?_=function(r){if(r===a||r===null)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(r),o=1;o<arguments.length;o++){var c=arguments[o];if(c!==a&&c!==null)for(var u in c)c.hasOwnProperty(u)&&(i[u]=c[u])}return i}:_=Object.assign;var m=C(function(r,i,o){for(var c=Object.keys(i),u=0;u<c.length;)(!o||o&&r[c[u]]===a)&&(r[c[u]]=i[c[u]]),u++;return r},"extend","Use `assign`."),D=C(function(r,i){return m(r,i,!0)},"merge","Use `assign`.");function I(e,r,i){var o=r.prototype,c;c=e.prototype=Object.create(o),c.constructor=e,c._super=o,i&&_(c,i)}function q(e,r){return function(){return e.apply(r,arguments)}}function y(e,r){return typeof e==T?e.apply(r&&r[0]||a,r):e}function J(e,r){return e===a?r:e}function X(e,r,i){N(W(r),function(o){e.addEventListener(o,i,!1)})}function G(e,r,i){N(W(r),function(o){e.removeEventListener(o,i,!1)})}function $(e,r){for(;e;){if(e==r)return!0;e=e.parentNode}return!1}function F(e,r){return e.indexOf(r)>-1}function W(e){return e.trim().split(/\s+/g)}function w(e,r,i){if(e.indexOf&&!i)return e.indexOf(r);for(var o=0;o<e.length;){if(i&&e[o][i]==r||!i&&e[o]===r)return o;o++}return-1}function z(e){return Array.prototype.slice.call(e,0)}function K(e,r,i){for(var o=[],c=[],u=0;u<e.length;){var v=e[u][r];w(c,v)<0&&o.push(e[u]),c[u]=v,u++}return o=o.sort(function(M,L){return M[r]>L[r]}),o}function A(e,r){for(var i,o,c=r[0].toUpperCase()+r.slice(1),u=0;u<h.length;){if(i=h[u],o=i?i+c:r,o in e)return o;u++}return a}var me=1;function ge(){return me++}function kt(e){var r=e.ownerDocument||e;return r.defaultView||r.parentWindow||s}var _e=/mobile|tablet|ip(ad|hone|od)|android/i,qt="ontouchstart"in s,Ae=A(s,"PointerEvent")!==a,Pe=qt&&_e.test(navigator.userAgent),lt="touch",Ne="pen",Lt="mouse",Ie="kinect",Se=25,U=1,st=2,S=4,x=8,gt=1,ut=2,ft=4,dt=8,vt=16,B=ut|ft,nt=dt|vt,yt=B|nt,jt=["x","y"],_t=["clientX","clientY"];function b(e,r){var i=this;this.manager=e,this.callback=r,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(o){y(e.options.enable,[e])&&i.handler(o)},this.init()}b.prototype={handler:function(){},init:function(){this.evEl&&X(this.element,this.evEl,this.domHandler),this.evTarget&&X(this.target,this.evTarget,this.domHandler),this.evWin&&X(kt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&G(this.element,this.evEl,this.domHandler),this.evTarget&&G(this.target,this.evTarget,this.domHandler),this.evWin&&G(kt(this.element),this.evWin,this.domHandler)}};function Oe(e){var r,i=e.options.inputClass;return i?r=i:Ae?r=Ft:Pe?r=Nt:qt?r=wt:r=Pt,new r(e,Re)}function Re(e,r,i){var o=i.pointers.length,c=i.changedPointers.length,u=r&U&&o-c===0,v=r&(S|x)&&o-c===0;i.isFirst=!!u,i.isFinal=!!v,u&&(e.session={}),i.eventType=r,Ce(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function Ce(e,r){var i=e.session,o=r.pointers,c=o.length;i.firstInput||(i.firstInput=Zt(r)),c>1&&!i.firstMultiple?i.firstMultiple=Zt(r):c===1&&(i.firstMultiple=!1);var u=i.firstInput,v=i.firstMultiple,R=v?v.center:u.center,M=r.center=Qt(o);r.timeStamp=E(),r.deltaTime=r.timeStamp-u.timeStamp,r.angle=xt(R,M),r.distance=At(R,M),De(i,r),r.offsetDirection=$t(r.deltaX,r.deltaY);var L=Jt(r.deltaTime,r.deltaX,r.deltaY);r.overallVelocityX=L.x,r.overallVelocityY=L.y,r.overallVelocity=f(L.x)>f(L.y)?L.x:L.y,r.scale=v?Le(v.pointers,o):1,r.rotation=v?Ue(v.pointers,o):0,r.maxPointers=i.prevInput?r.pointers.length>i.prevInput.maxPointers?r.pointers.length:i.prevInput.maxPointers:r.pointers.length,Me(i,r);var k=e.element;$(r.srcEvent.target,k)&&(k=r.srcEvent.target),r.target=k}function De(e,r){var i=r.center,o=e.offsetDelta||{},c=e.prevDelta||{},u=e.prevInput||{};(r.eventType===U||u.eventType===S)&&(c=e.prevDelta={x:u.deltaX||0,y:u.deltaY||0},o=e.offsetDelta={x:i.x,y:i.y}),r.deltaX=c.x+(i.x-o.x),r.deltaY=c.y+(i.y-o.y)}function Me(e,r){var i=e.lastInterval||r,o=r.timeStamp-i.timeStamp,c,u,v,R;if(r.eventType!=x&&(o>Se||i.velocity===a)){var M=r.deltaX-i.deltaX,L=r.deltaY-i.deltaY,k=Jt(o,M,L);u=k.x,v=k.y,c=f(k.x)>f(k.y)?k.x:k.y,R=$t(M,L),e.lastInterval=r}else c=i.velocity,u=i.velocityX,v=i.velocityY,R=i.direction;r.velocity=c,r.velocityX=u,r.velocityY=v,r.direction=R}function Zt(e){for(var r=[],i=0;i<e.pointers.length;)r[i]={clientX:p(e.pointers[i].clientX),clientY:p(e.pointers[i].clientY)},i++;return{timeStamp:E(),pointers:r,center:Qt(r),deltaX:e.deltaX,deltaY:e.deltaY}}function Qt(e){var r=e.length;if(r===1)return{x:p(e[0].clientX),y:p(e[0].clientY)};for(var i=0,o=0,c=0;c<r;)i+=e[c].clientX,o+=e[c].clientY,c++;return{x:p(i/r),y:p(o/r)}}function Jt(e,r,i){return{x:r/e||0,y:i/e||0}}function $t(e,r){return e===r?gt:f(e)>=f(r)?e<0?ut:ft:r<0?dt:vt}function At(e,r,i){i||(i=jt);var o=r[i[0]]-e[i[0]],c=r[i[1]]-e[i[1]];return Math.sqrt(o*o+c*c)}function xt(e,r,i){i||(i=jt);var o=r[i[0]]-e[i[0]],c=r[i[1]]-e[i[1]];return Math.atan2(c,o)*180/Math.PI}function Ue(e,r){return xt(r[1],r[0],_t)+xt(e[1],e[0],_t)}function Le(e,r){return At(r[0],r[1],_t)/At(e[0],e[1],_t)}var xe={mousedown:U,mousemove:st,mouseup:S},Fe="mousedown",we="mousemove mouseup";function Pt(){this.evEl=Fe,this.evWin=we,this.pressed=!1,b.apply(this,arguments)}I(Pt,b,{handler:function(r){var i=xe[r.type];i&U&&r.button===0&&(this.pressed=!0),i&st&&r.which!==1&&(i=S),this.pressed&&(i&S&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[r],changedPointers:[r],pointerType:Lt,srcEvent:r}))}});var be={pointerdown:U,pointermove:st,pointerup:S,pointercancel:x,pointerout:x},He={2:lt,3:Ne,4:Lt,5:Ie},Kt="pointerdown",te="pointermove pointerup pointercancel";s.MSPointerEvent&&!s.PointerEvent&&(Kt="MSPointerDown",te="MSPointerMove MSPointerUp MSPointerCancel");function Ft(){this.evEl=Kt,this.evWin=te,b.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}I(Ft,b,{handler:function(r){var i=this.store,o=!1,c=r.type.toLowerCase().replace("ms",""),u=be[c],v=He[r.pointerType]||r.pointerType,R=v==lt,M=w(i,r.pointerId,"pointerId");u&U&&(r.button===0||R)?M<0&&(i.push(r),M=i.length-1):u&(S|x)&&(o=!0),!(M<0)&&(i[M]=r,this.callback(this.manager,u,{pointers:i,changedPointers:[r],pointerType:v,srcEvent:r}),o&&i.splice(M,1))}});var Ye={touchstart:U,touchmove:st,touchend:S,touchcancel:x},Xe="touchstart",Ge="touchstart touchmove touchend touchcancel";function ee(){this.evTarget=Xe,this.evWin=Ge,this.started=!1,b.apply(this,arguments)}I(ee,b,{handler:function(r){var i=Ye[r.type];if(i===U&&(this.started=!0),!!this.started){var o=We.call(this,r,i);i&(S|x)&&o[0].length-o[1].length===0&&(this.started=!1),this.callback(this.manager,i,{pointers:o[0],changedPointers:o[1],pointerType:lt,srcEvent:r})}}});function We(e,r){var i=z(e.touches),o=z(e.changedTouches);return r&(S|x)&&(i=K(i.concat(o),"identifier")),[i,o]}var ze={touchstart:U,touchmove:st,touchend:S,touchcancel:x},Be="touchstart touchmove touchend touchcancel";function Nt(){this.evTarget=Be,this.targetIds={},b.apply(this,arguments)}I(Nt,b,{handler:function(r){var i=ze[r.type],o=Ve.call(this,r,i);o&&this.callback(this.manager,i,{pointers:o[0],changedPointers:o[1],pointerType:lt,srcEvent:r})}});function Ve(e,r){var i=z(e.touches),o=this.targetIds;if(r&(U|st)&&i.length===1)return o[i[0].identifier]=!0,[i,i];var c,u,v=z(e.changedTouches),R=[],M=this.target;if(u=i.filter(function(L){return $(L.target,M)}),r===U)for(c=0;c<u.length;)o[u[c].identifier]=!0,c++;for(c=0;c<v.length;)o[v[c].identifier]&&R.push(v[c]),r&(S|x)&&delete o[v[c].identifier],c++;if(R.length)return[K(u.concat(R),"identifier"),R]}var ke=2500,re=25;function wt(){b.apply(this,arguments);var e=q(this.handler,this);this.touch=new Nt(this.manager,e),this.mouse=new Pt(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}I(wt,b,{handler:function(r,i,o){var c=o.pointerType==lt,u=o.pointerType==Lt;if(!(u&&o.sourceCapabilities&&o.sourceCapabilities.firesTouchEvents)){if(c)qe.call(this,i,o);else if(u&&ye.call(this,o))return;this.callback(r,i,o)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function qe(e,r){e&U?(this.primaryTouch=r.changedPointers[0].identifier,ie.call(this,r)):e&(S|x)&&ie.call(this,r)}function ie(e){var r=e.changedPointers[0];if(r.identifier===this.primaryTouch){var i={x:r.clientX,y:r.clientY};this.lastTouches.push(i);var o=this.lastTouches,c=function(){var u=o.indexOf(i);u>-1&&o.splice(u,1)};setTimeout(c,ke)}}function ye(e){for(var r=e.srcEvent.clientX,i=e.srcEvent.clientY,o=0;o<this.lastTouches.length;o++){var c=this.lastTouches[o],u=Math.abs(r-c.x),v=Math.abs(i-c.y);if(u<=re&&v<=re)return!0}return!1}var se=A(d.style,"touchAction"),ne=se!==a,oe="compute",ae="auto",bt="manipulation",ot="none",pt="pan-x",Tt="pan-y",It=Ze();function Ht(e,r){this.manager=e,this.set(r)}Ht.prototype={set:function(e){e==oe&&(e=this.compute()),ne&&this.manager.element.style&&It[e]&&(this.manager.element.style[se]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return N(this.manager.recognizers,function(r){y(r.options.enable,[r])&&(e=e.concat(r.getTouchAction()))}),je(e.join(" "))},preventDefaults:function(e){var r=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented){r.preventDefault();return}var o=this.actions,c=F(o,ot)&&!It[ot],u=F(o,Tt)&&!It[Tt],v=F(o,pt)&&!It[pt];if(c){var R=e.pointers.length===1,M=e.distance<2,L=e.deltaTime<250;if(R&&M&&L)return}if(!(v&&u)&&(c||u&&i&B||v&&i&nt))return this.preventSrc(r)},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function je(e){if(F(e,ot))return ot;var r=F(e,pt),i=F(e,Tt);return r&&i?ot:r||i?r?pt:Tt:F(e,bt)?bt:ae}function Ze(){if(!ne)return!1;var e={},r=s.CSS&&s.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){e[i]=r?s.CSS.supports("touch-action",i):!0}),e}var St=1,H=2,ht=4,tt=8,j=tt,Et=16,V=32;function Z(e){this.options=_({},this.defaults,e||{}),this.id=ge(),this.manager=null,this.options.enable=J(this.options.enable,!0),this.state=St,this.simultaneous={},this.requireFail=[]}Z.prototype={defaults:{},set:function(e){return _(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(P(e,"recognizeWith",this))return this;var r=this.simultaneous;return e=Ot(e,this),r[e.id]||(r[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return P(e,"dropRecognizeWith",this)?this:(e=Ot(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(P(e,"requireFailure",this))return this;var r=this.requireFail;return e=Ot(e,this),w(r,e)===-1&&(r.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(P(e,"dropRequireFailure",this))return this;e=Ot(e,this);var r=w(this.requireFail,e);return r>-1&&this.requireFail.splice(r,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var r=this,i=this.state;function o(c){r.manager.emit(c,e)}i<tt&&o(r.options.event+he(i)),o(r.options.event),e.additionalEvent&&o(e.additionalEvent),i>=tt&&o(r.options.event+he(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=V},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(V|St)))return!1;e++}return!0},recognize:function(e){var r=_({},e);if(!y(this.options.enable,[this,r])){this.reset(),this.state=V;return}this.state&(j|Et|V)&&(this.state=St),this.state=this.process(r),this.state&(H|ht|tt|Et)&&this.tryEmit(r)},process:function(e){},getTouchAction:function(){},reset:function(){}};function he(e){return e&Et?"cancel":e&tt?"end":e&ht?"move":e&H?"start":""}function ce(e){return e==vt?"down":e==dt?"up":e==ut?"left":e==ft?"right":""}function Ot(e,r){var i=r.manager;return i?i.get(e):e}function Y(){Z.apply(this,arguments)}I(Y,Z,{defaults:{pointers:1},attrTest:function(e){var r=this.options.pointers;return r===0||e.pointers.length===r},process:function(e){var r=this.state,i=e.eventType,o=r&(H|ht),c=this.attrTest(e);return o&&(i&x||!c)?r|Et:o||c?i&S?r|tt:r&H?r|ht:H:V}});function Rt(){Y.apply(this,arguments),this.pX=null,this.pY=null}I(Rt,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:yt},getTouchAction:function(){var e=this.options.direction,r=[];return e&B&&r.push(Tt),e&nt&&r.push(pt),r},directionTest:function(e){var r=this.options,i=!0,o=e.distance,c=e.direction,u=e.deltaX,v=e.deltaY;return c&r.direction||(r.direction&B?(c=u===0?gt:u<0?ut:ft,i=u!=this.pX,o=Math.abs(e.deltaX)):(c=v===0?gt:v<0?dt:vt,i=v!=this.pY,o=Math.abs(e.deltaY))),e.direction=c,i&&o>r.threshold&&c&r.direction},attrTest:function(e){return Y.prototype.attrTest.call(this,e)&&(this.state&H||!(this.state&H)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var r=ce(e.direction);r&&(e.additionalEvent=this.options.event+r),this._super.emit.call(this,e)}});function Yt(){Y.apply(this,arguments)}I(Yt,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ot]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&H)},emit:function(e){if(e.scale!==1){var r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}this._super.emit.call(this,e)}});function Xt(){Z.apply(this,arguments),this._timer=null,this._input=null}I(Xt,Z,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ae]},process:function(e){var r=this.options,i=e.pointers.length===r.pointers,o=e.distance<r.threshold,c=e.deltaTime>r.time;if(this._input=e,!o||!i||e.eventType&(S|x)&&!c)this.reset();else if(e.eventType&U)this.reset(),this._timer=O(function(){this.state=j,this.tryEmit()},r.time,this);else if(e.eventType&S)return j;return V},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===j&&(e&&e.eventType&S?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=E(),this.manager.emit(this.options.event,this._input)))}});function Gt(){Y.apply(this,arguments)}I(Gt,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ot]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&H)}});function Wt(){Y.apply(this,arguments)}I(Wt,Y,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:B|nt,pointers:1},getTouchAction:function(){return Rt.prototype.getTouchAction.call(this)},attrTest:function(e){var r=this.options.direction,i;return r&(B|nt)?i=e.overallVelocity:r&B?i=e.overallVelocityX:r&nt&&(i=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(i)>this.options.velocity&&e.eventType&S},emit:function(e){var r=ce(e.offsetDirection);r&&this.manager.emit(this.options.event+r,e),this.manager.emit(this.options.event,e)}});function Ct(){Z.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}I(Ct,Z,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[bt]},process:function(e){var r=this.options,i=e.pointers.length===r.pointers,o=e.distance<r.threshold,c=e.deltaTime<r.time;if(this.reset(),e.eventType&U&&this.count===0)return this.failTimeout();if(o&&c&&i){if(e.eventType!=S)return this.failTimeout();var u=this.pTime?e.timeStamp-this.pTime<r.interval:!0,v=!this.pCenter||At(this.pCenter,e.center)<r.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,!v||!u?this.count=1:this.count+=1,this._input=e;var R=this.count%r.taps;if(R===0)return this.hasRequireFailures()?(this._timer=O(function(){this.state=j,this.tryEmit()},r.interval,this),H):j}return V},failTimeout:function(){return this._timer=O(function(){this.state=V},this.options.interval,this),V},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==j&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function et(e,r){return r=r||{},r.recognizers=J(r.recognizers,et.defaults.preset),new zt(e,r)}et.VERSION="2.0.7",et.defaults={domEvents:!1,touchAction:oe,enable:!0,inputTarget:null,inputClass:null,preset:[[Gt,{enable:!1}],[Yt,{enable:!1},["rotate"]],[Wt,{direction:B}],[Rt,{direction:B},["swipe"]],[Ct],[Ct,{event:"doubletap",taps:2},["tap"]],[Xt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Qe=1,le=2;function zt(e,r){this.options=_({},et.defaults,r||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=Oe(this),this.touchAction=new Ht(this,this.options.touchAction),ue(this,!0),N(this.options.recognizers,function(i){var o=this.add(new i[0](i[1]));i[2]&&o.recognizeWith(i[2]),i[3]&&o.requireFailure(i[3])},this)}zt.prototype={set:function(e){return _(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?le:Qe},recognize:function(e){var r=this.session;if(!r.stopped){this.touchAction.preventDefaults(e);var i,o=this.recognizers,c=r.curRecognizer;(!c||c&&c.state&j)&&(c=r.curRecognizer=null);for(var u=0;u<o.length;)i=o[u],r.stopped!==le&&(!c||i==c||i.canRecognizeWith(c))?i.recognize(e):i.reset(),!c&&i.state&(H|ht|tt)&&(c=r.curRecognizer=i),u++}},get:function(e){if(e instanceof Z)return e;for(var r=this.recognizers,i=0;i<r.length;i++)if(r[i].options.event==e)return r[i];return null},add:function(e){if(P(e,"add",this))return this;var r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(P(e,"remove",this))return this;if(e=this.get(e),e){var r=this.recognizers,i=w(r,e);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this},on:function(e,r){if(e!==a&&r!==a){var i=this.handlers;return N(W(e),function(o){i[o]=i[o]||[],i[o].push(r)}),this}},off:function(e,r){if(e!==a){var i=this.handlers;return N(W(e),function(o){r?i[o]&&i[o].splice(w(i[o],r),1):delete i[o]}),this}},emit:function(e,r){this.options.domEvents&&Je(e,r);var i=this.handlers[e]&&this.handlers[e].slice();if(!(!i||!i.length)){r.type=e,r.preventDefault=function(){r.srcEvent.preventDefault()};for(var o=0;o<i.length;)i[o](r),o++}},destroy:function(){this.element&&ue(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ue(e,r){var i=e.element;if(i.style){var o;N(e.options.cssProps,function(c,u){o=A(i.style,u),r?(e.oldCssProps[o]=i.style[o],i.style[o]=c):i.style[o]=e.oldCssProps[o]||""}),r||(e.oldCssProps={})}}function Je(e,r){var i=n.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=r,r.target.dispatchEvent(i)}_(et,{INPUT_START:U,INPUT_MOVE:st,INPUT_END:S,INPUT_CANCEL:x,STATE_POSSIBLE:St,STATE_BEGAN:H,STATE_CHANGED:ht,STATE_ENDED:tt,STATE_RECOGNIZED:j,STATE_CANCELLED:Et,STATE_FAILED:V,DIRECTION_NONE:gt,DIRECTION_LEFT:ut,DIRECTION_RIGHT:ft,DIRECTION_UP:dt,DIRECTION_DOWN:vt,DIRECTION_HORIZONTAL:B,DIRECTION_VERTICAL:nt,DIRECTION_ALL:yt,Manager:zt,Input:b,TouchAction:Ht,TouchInput:Nt,MouseInput:Pt,PointerEventInput:Ft,TouchMouseInput:wt,SingleTouchInput:ee,Recognizer:Z,AttrRecognizer:Y,Tap:Ct,Pan:Rt,Swipe:Wt,Pinch:Yt,Rotate:Gt,Press:Xt,on:X,off:G,each:N,merge:D,extend:m,assign:_,inherit:I,bindFn:q,prefixed:A});var $e=typeof s<"u"?s:typeof self<"u"?self:{};$e.Hammer=et,t.exports?t.exports=et:s[l]=et})(window,document,"Hammer")})(vr);const ve={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,ARROWLEFT:37,ARROWUP:38,ARROWRIGHT:39,ARROWDOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOWS:91,"RIGHT CLICK":93,"NUMPAD 0":96,"NUMPAD 1":97,"NUMPAD 2":98,"NUMPAD 3":99,"NUMPAD 4":100,"NUMPAD 5":101,"NUMPAD 6":102,"NUMPAD 7":103,"NUMPAD 8":104,"NUMPAD 9":105,"NUMPAD *":106,"NUMPAD +":107,"NUMPAD -":109,"NUMPAD .":110,"NUMPAD /":111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"NUM LOCK":144,"SCROLL LOCK":145,"MY COMPUTER":182,"MY CALCULATOR":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};var ct=(t=>(t[t.BACKSPACE=8]="BACKSPACE",t[t.TAB=9]="TAB",t[t.ENTER=13]="ENTER",t[t.SHIFT=16]="SHIFT",t[t.CTRL=17]="CTRL",t[t.ALT=18]="ALT",t[t.PAUSEBREAK=19]="PAUSEBREAK",t[t.CAPSLOCK=20]="CAPSLOCK",t[t.ESC=27]="ESC",t[t.SPACE=32]="SPACE",t[t.PAGEUP=33]="PAGEUP",t[t.PAGEDOWN=34]="PAGEDOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.INSERT=45]="INSERT",t[t.DELETE=46]="DELETE",t[t.ZERO=48]="ZERO",t[t.ONE=49]="ONE",t[t.TWO=50]="TWO",t[t.THREE=51]="THREE",t[t.FOUR=52]="FOUR",t[t.FIVE=53]="FIVE",t[t.SIX=54]="SIX",t[t.SEVEN=55]="SEVEN",t[t.EIGHT=56]="EIGHT",t[t.NINE=57]="NINE",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.WINDOWS=91]="WINDOWS",t[t.RIGHTCLICK=93]="RIGHTCLICK",t[t.NUMPAD0=96]="NUMPAD0",t[t.NUMPAD1=97]="NUMPAD1",t[t.NUMPAD2=98]="NUMPAD2",t[t.NUMPAD3=99]="NUMPAD3",t[t.NUMPAD4=100]="NUMPAD4",t[t.NUMPAD5=101]="NUMPAD5",t[t.NUMPAD6=102]="NUMPAD6",t[t.NUMPAD7=103]="NUMPAD7",t[t.NUMPAD8=104]="NUMPAD8",t[t.NUMPAD9=105]="NUMPAD9",t[t.NUMPADMUL=106]="NUMPADMUL",t[t.NUMPADADD=107]="NUMPADADD",t[t.NUMPADSUB=109]="NUMPADSUB",t[t.NUMPADDOT=110]="NUMPADDOT",t[t.NUMPADSLASH=111]="NUMPADSLASH",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NUMLOCK=144]="NUMLOCK",t[t.SCROLLLOCK=145]="SCROLLLOCK",t[t.MYCOMPUTER=182]="MYCOMPUTER",t[t.MYCALCULATOR=183]="MYCALCULATOR",t[t.SEMICOLON=186]="SEMICOLON",t[t.EQUAL=187]="EQUAL",t[t.COMMA=188]="COMMA",t[t.DASH=189]="DASH",t[t.DOT=190]="DOT",t[t.SLASH=191]="SLASH",t[t.BACKTICK=192]="BACKTICK",t[t.LEFTSQRBRACKET=219]="LEFTSQRBRACKET",t[t.BACKSLASH=220]="BACKSLASH",t[t.RIGHTSQRBRACKET=221]="RIGHTSQRBRACKET",t[t.SINGLEQUOTE=222]="SINGLEQUOTE",t))(ct||{});class pr{constructor(){g(this,"state");g(this,"mouse");g(this,"raf_id");this.state={},this.mouse={left:!1,middle:!1,right:!1,wheel:{x:0,y:0,z:0},pos:[0,0]},this.raf_id=null,document.addEventListener("keydown",h=>this.handle_key(h,!0)),document.addEventListener("keyup",h=>this.handle_key(h,!1)),document.addEventListener("mousedown",h=>this._mousedown(h,!0)),document.addEventListener("mouseup",h=>this._mousedown(h,!1)),document.addEventListener("wheel",h=>this.wheel(h.deltaX,h.deltaY,h.deltaZ)),document.addEventListener("mousemove",h=>this._mousemove(h));const s=h=>h.touches.length===1?[h.touches[0].pageX,h.touches[0].pageY]:h.touches.length>=2?[(h.touches[0].pageX+h.touches[1].pageX)/2,(h.touches[0].pageY+h.touches[1].pageY)/2]:[0,0];document.addEventListener("touchstart",h=>{this.mouse.left=!0,this.mouse.pos=s(h)}),document.addEventListener("touchmove",h=>{this.mouse.pos=s(h)}),document.addEventListener("touchend",()=>{this.mouse.left=!1});const n=document.getElementById("app");if(!n)throw new Error;const l=new Hammer(n),a=new Hammer.Pinch;l.add([a]),l.on("pinch",h=>this.wheel(0,(h.pointers[0][1]+h.pointers[1][1])/2,0))}keydown(s){return this.state[s]}_mousedown(s,n){const l=n||s.type==="mousedown";this.mouse.left=s.button===0&&l,this.mouse.middle=s.button===1&&l,this.mouse.right=s.button===2&&l}_mousemove(s){this.mouse.pos[0]=s.x,this.mouse.pos[1]=s.y}wheel(s,n,l){this.mouse.wheel.x=s,this.mouse.wheel.y=n,this.mouse.wheel.z=l,this.raf_id||(this.raf_id=requestAnimationFrame(()=>{this.mouse.wheel.x=0,this.mouse.wheel.y=0,this.mouse.wheel.z=0,this.raf_id=null}))}handle_key(s,n){s.key.toUpperCase()in ve||it(`Unhandled key: ${s.key.toUpperCase()}`),this.state[ve[s.key.toUpperCase()]]=n||s.type==="keydown"}}class Tr{constructor(s,n,l){g(this,"width");g(this,"height");g(this,"pos");g(this,"zoom");g(this,"speed");g(this,"projection_matrix");g(this,"start_drag");g(this,"offset");this.width=s,this.height=n,this.pos=[0,0],this.zoom=1,this.speed=l||500,this.projection_matrix=Mt(),this.start_drag=null,this.offset=[0,0]}handle_zoom(s){this.zoom+=-Math.sign(s.mouse.wheel.y)*(this.zoom*.6),this.zoom=Math.min(Math.max(this.zoom,.1),10);const n=fe(this,s.mouse.pos);this.update_projection_matrix();const l=fe(this,s.mouse.pos);this.pos[0]+=n[0]-l[0],this.pos[1]+=n[1]-l[1]}handle_drag(s){this.start_drag&&(this.offset[0]=(this.start_drag[0]-s.mouse.pos[0])/this.zoom,this.offset[1]=(this.start_drag[1]-s.mouse.pos[1])/this.zoom)}update(s,n){let l=1/this.zoom*2*this.speed*n;s.keydown(ct.SHIFT)&&(l*=5),s.keydown(ct.W)&&(this.pos[1]+=-l),s.keydown(ct.A)&&(this.pos[0]+=-l),s.keydown(ct.S)&&(this.pos[1]+=l),s.keydown(ct.D)&&(this.pos[0]+=l),s.mouse.left&&this.start_drag===null?this.start_drag=[...s.mouse.pos]:s.mouse.left&&this.start_drag?this.handle_drag(s):!s.mouse.left&&this.start_drag&&(this.start_drag=null,this.pos[0]+=this.offset[0],this.pos[1]+=this.offset[1],this.offset=[0,0]),s.mouse.wheel.y&&this.handle_zoom(s),this.update_projection_matrix()}update_projection_matrix(){const s=Mt(),n=this.pos[0]+this.offset[0],l=this.pos[0]+this.offset[0]+this.width/this.zoom,a=this.pos[1]+this.offset[1],h=this.pos[1]+this.offset[1]+this.height/this.zoom;or(s,n,l,h,a,-1,1),this.projection_matrix=s}}class Er extends Ee{constructor(n){super();g(this,"src");g(this,"texture");this.src=n,this.texture=this.load_texture(n)}load_texture(n){const l=this.gl.createTexture();if(!l)throw new Error;this.gl.bindTexture(this.gl.TEXTURE_2D,l),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);const a=new Image;return a.src=n,a.onload=()=>{this.gl.bindTexture(this.gl.TEXTURE_2D,l),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.generateMipmap(this.gl.TEXTURE_2D)},l}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)}delete(){this.gl.deleteTexture(this.texture)}}(async()=>{const t=Vt(),s=document.querySelector("#app"),n=s==null?void 0:s.querySelector("canvas");if(!n)return;n.width=window.innerWidth,n.height=window.innerHeight;const l=new ur([{id:"default",type:Ut.FRAGMENT,source:fr},{id:"default",type:Ut.VERTEX,source:dr}]);l.bind();const a=await fetch("note_atlas.json").then(async m=>await m.json()),h=m=>{const D=m%a.tex_in_row*a.tex_size[0],I=Math.floor(m/a.tex_in_row)*a.tex_size[1];return[D/a.size[0],I/a.size[1],(D+a.tex_size[0])/a.size[0],(I+a.tex_size[1])/a.size[1]]},d=new Er("note_atlas.png"),T=new pr,p=new Tr(n.width,n.height),f=[],E=32;for(let m=0;m<100;m++)f.push(new at([m*E,m*E],[E,E],h(m%a.tex_count)));const O=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,O),t.bufferData(t.ARRAY_BUFFER,at.vertices,t.STATIC_DRAW);const P=Float32Array.BYTES_PER_ELEMENT;t.vertexAttribPointer(0,2,t.FLOAT,!1,2*P,0),t.enableVertexAttribArray(0);const N=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,N),t.bufferData(t.ELEMENT_ARRAY_BUFFER,at.indices,t.STATIC_DRAW),at.setup_instanced_attributes(t,f);let C=-1;const _=m=>{if(!t)return;const D=C>0?(m-C)/1e3:1;C=m,t.clearColor(30/255,30/255,30/255,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),p.update(T,D),t.uniformMatrix4fv(l.get_uniform("projection"),!1,p.projection_matrix),d.bind(),t.drawElementsInstanced(t.TRIANGLES,at.index_count,t.UNSIGNED_SHORT,0,f.length),requestAnimationFrame(_)};t.viewport(0,0,n.width,n.height),requestAnimationFrame(_)})();
