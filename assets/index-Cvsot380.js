var tr=Object.defineProperty;var er=(t,s,o)=>s in t?tr(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o;var g=(t,s,o)=>er(t,typeof s!="symbol"?s+"":s,o);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}})();var Dt=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,s=arguments.length;s--;)t+=arguments[s]*arguments[s];return Math.sqrt(t)});function Mt(){var t=new Dt(16);return Dt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function rr(t,s){var o=s[0],c=s[1],a=s[2],l=s[3],d=s[4],p=s[5],T=s[6],f=s[7],E=s[8],O=s[9],P=s[10],N=s[11],C=s[12],_=s[13],m=s[14],D=s[15],I=o*p-c*d,q=o*T-a*d,y=o*f-l*d,J=c*T-a*p,X=c*f-l*p,G=a*f-l*T,$=E*_-O*C,F=E*m-P*C,W=E*D-N*C,w=O*m-P*_,z=O*D-N*_,K=P*D-N*m,A=I*K-q*z+y*w+J*W-X*F+G*$;return A?(A=1/A,t[0]=(p*K-T*z+f*w)*A,t[1]=(a*z-c*K-l*w)*A,t[2]=(_*G-m*X+D*J)*A,t[3]=(P*X-O*G-N*J)*A,t[4]=(T*W-d*K-f*F)*A,t[5]=(o*K-a*W+l*F)*A,t[6]=(m*y-C*G-D*q)*A,t[7]=(E*G-P*y+N*q)*A,t[8]=(d*z-p*W+f*$)*A,t[9]=(c*W-o*z-l*$)*A,t[10]=(C*X-_*y+D*I)*A,t[11]=(O*y-E*X-N*I)*A,t[12]=(p*F-d*w-T*$)*A,t[13]=(o*w-c*F+a*$)*A,t[14]=(_*q-C*J-m*I)*A,t[15]=(E*J-O*q+P*I)*A,t):null}function ir(t,s,o){var c=o[0],a=o[1],l=o[2],d,p,T,f,E,O,P,N,C,_,m,D;return s===t?(t[12]=s[0]*c+s[4]*a+s[8]*l+s[12],t[13]=s[1]*c+s[5]*a+s[9]*l+s[13],t[14]=s[2]*c+s[6]*a+s[10]*l+s[14],t[15]=s[3]*c+s[7]*a+s[11]*l+s[15]):(d=s[0],p=s[1],T=s[2],f=s[3],E=s[4],O=s[5],P=s[6],N=s[7],C=s[8],_=s[9],m=s[10],D=s[11],t[0]=d,t[1]=p,t[2]=T,t[3]=f,t[4]=E,t[5]=O,t[6]=P,t[7]=N,t[8]=C,t[9]=_,t[10]=m,t[11]=D,t[12]=d*c+E*a+C*l+s[12],t[13]=p*c+O*a+_*l+s[13],t[14]=T*c+P*a+m*l+s[14],t[15]=f*c+N*a+D*l+s[15]),t}function sr(t,s,o){var c=o[0],a=o[1],l=o[2];return t[0]=s[0]*c,t[1]=s[1]*c,t[2]=s[2]*c,t[3]=s[3]*c,t[4]=s[4]*a,t[5]=s[5]*a,t[6]=s[6]*a,t[7]=s[7]*a,t[8]=s[8]*l,t[9]=s[9]*l,t[10]=s[10]*l,t[11]=s[11]*l,t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],t}function nr(t,s,o){var c=Math.sin(o),a=Math.cos(o),l=s[0],d=s[1],p=s[2],T=s[3],f=s[4],E=s[5],O=s[6],P=s[7];return s!==t&&(t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15]),t[0]=l*a+f*c,t[1]=d*a+E*c,t[2]=p*a+O*c,t[3]=T*a+P*c,t[4]=f*a-l*c,t[5]=E*a-d*c,t[6]=O*a-p*c,t[7]=P*a-T*c,t}function or(t,s,o,c,a,l,d){var p=1/(s-o),T=1/(c-a),f=1/(l-d);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*T,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(s+o)*p,t[13]=(a+c)*T,t[14]=(d+l)*f,t[15]=1,t}var ar=or;function Te(){var t=new Dt(3);return Dt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function hr(t,s,o){var c=s[0],a=s[1],l=s[2],d=o[3]*c+o[7]*a+o[11]*l+o[15];return d=d||1,t[0]=(o[0]*c+o[4]*a+o[8]*l+o[12])/d,t[1]=(o[1]*c+o[5]*a+o[9]*l+o[13])/d,t[2]=(o[2]*c+o[6]*a+o[10]*l+o[14])/d,t}(function(){var t=Te();return function(s,o,c,a,l,d){var p,T;for(o||(o=3),c||(c=0),a?T=Math.min(a*o+c,s.length):T=s.length,p=c;p<T;p+=o)t[0]=s[p],t[1]=s[p+1],t[2]=s[p+2],l(t,t,d),s[p]=t[0],s[p+1]=t[1],s[p+2]=t[2];return s}})();const cr=t=>{const s=new Date,o={yyyy:s.getFullYear(),MM:String(s.getMonth()+1).padStart(2,"0"),dd:String(s.getDate()).padStart(2,"0"),HH:String(s.getHours()).padStart(2,"0"),mm:String(s.getMinutes()).padStart(2,"0"),ss:String(s.getSeconds()).padStart(2,"0"),M:s.getMonth()+1,d:s.getDate(),H:s.getHours(),m:s.getMinutes(),s:s.getSeconds(),a:s.getHours()<12?"AM":"PM"};return t.replace(/yyyy|MM|dd|HH|mm|ss|M|d|H|m|s|a/g,c=>o[c].toString())},fe=(t,s)=>{const o=Mt();rr(o,t.projection_matrix);const c=[s[0]/t.width*2-1,1-s[1]/t.height*2,0],a=Te();return hr(a,c,o),[a[0],a[1]]},Q=document.querySelector("#console"),pe=(t,s)=>{const o=document.createElement("p");o.textContent=`[${cr("dd-mm-yyyy s:m:H")}] ${t}`,o.style.color=s,o.classList.add("console-text"),Q==null||Q.appendChild(o),Q==null||Q.classList.remove("hide"),setTimeout(()=>{Q==null||Q.classList.add("hide")},1e3*10)},it=t=>{pe(`[ ERROR ] ${t}`,"red")},lr=t=>{pe(`[ INFO â €] ${t}`,"white")};let mt;const Bt=document.querySelector("#app"),de=Bt==null?void 0:Bt.querySelector("canvas"),Vt=()=>{if(mt)return mt;if(!de)throw it("Could not find canvas element"),new Error("opengl_context() error");if(mt=de.getContext("webgl2"),!mt)throw it("WebGl is not supported in this device"),new Error("opengl_context() error");return mt};class Ee{constructor(){g(this,"gl");this.gl=Vt()}}class me extends Ee{constructor(){super();g(this,"id");this.id=0}}var Ut=(t=>(t[t.FRAGMENT=0]="FRAGMENT",t[t.VERTEX=1]="VERTEX",t))(Ut||{});const ur=(t,s)=>{const o=Vt(),c=[o.FRAGMENT_SHADER,o.VERTEX_SHADER],a=o.createShader(c[s]);if(!a)return it(`Failed to create shader type ${s}`),null;if(o.shaderSource(a,t),o.compileShader(a),!o.getShaderParameter(a,o.COMPILE_STATUS)){const l=o.getShaderInfoLog(a);if(l)return it(`Failed to compile shader type ${Ut[s]}: ${l}`),null}return a};class fr extends me{constructor(o){super();g(this,"shaders");g(this,"program");this.shaders=o;const c=this.gl.createProgram();if(!c)throw it("Cannot create program"),new Error;this.program=c,this.process_shaders(o)}bind(){this.gl.useProgram(this.program)}unbind(){this.gl.useProgram(null)}delete(){this.gl.deleteProgram(this.program)}get_uniform(o){const c=this.gl.getUniformLocation(this.program,o);if(!c)throw it(`Could not get uniform "${o}"`),new Error;return c}link(){if(this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)){const o=this.gl.getProgramInfoLog(this.program);if(o){it(`Failed to link shader: ${o}`);return}}}process_shaders(o){for(const c of o){const a=ur(c.source,c.type);if(!a)throw new Error;this.gl.attachShader(this.program,a),this.gl.deleteShader(a)}this.link()}}const dr=`#version 300 es
precision mediump float;

in vec2 v_texcoord;
out vec4 frag_color;

uniform sampler2D tex;

void main()
{
  frag_color = texture(tex, v_texcoord);
}
`,vr=`#version 300 es
precision mediump float;

layout (location = 0) in vec2 position;
layout (location = 1) in vec2 offset;
layout (location = 2) in vec2 scale;
layout (location = 3) in vec4 texcoord;
layout (location = 4) in float rotation;

uniform mat4 projection;

out vec2 v_texcoord;

void main()
{
  float cos_rot = cos(rotation);
  float sin_rot = sin(rotation);

  mat2 rot_matrix = mat2(
    cos_rot, -sin_rot,
    sin_rot, cos_rot
  );

  vec2 rotated_scaled = rot_matrix * (position * scale);

  gl_Position = projection * vec4(rotated_scaled + offset, 0.0, 1.0);
  v_texcoord = mix(texcoord.xy, texcoord.zw, position + 0.5);
}
`,rt=class rt extends Ee{constructor(o,c,a,l){super();g(this,"pos");g(this,"size");g(this,"texcoord");g(this,"rotation");this.pos=o,this.size=c,this.texcoord=a,this.rotation=l||0}get_model_matrix(){const o=Mt();return ir(o,o,[this.pos[0],this.pos[1],0]),sr(o,o,[this.size[0],this.size[1],0]),nr(o,o,this.rotation*(Math.PI/180)),o}static setup_instanced_attributes(o,c){const l=new Float32Array(c.length*9),d=Float32Array.BYTES_PER_ELEMENT;c.forEach((f,E)=>{l[E*9+0]=f.pos[0],l[E*9+1]=f.pos[1],l[E*9+2]=f.size[0],l[E*9+3]=f.size[1],l[E*9+4]=f.texcoord[0],l[E*9+5]=f.texcoord[1],l[E*9+6]=f.texcoord[2],l[E*9+7]=f.texcoord[3],l[E*9+8]=f.rotation*(Math.PI/180)});const p=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,p),o.bufferData(o.ARRAY_BUFFER,l,o.STATIC_DRAW);const T=9*d;o.vertexAttribPointer(1,2,o.FLOAT,!1,T,0),o.enableVertexAttribArray(1),o.vertexAttribDivisor(1,1),o.vertexAttribPointer(2,2,o.FLOAT,!1,T,2*d),o.enableVertexAttribArray(2),o.vertexAttribDivisor(2,1),o.vertexAttribPointer(3,4,o.FLOAT,!1,T,4*d),o.enableVertexAttribArray(3),o.vertexAttribDivisor(3,1),o.vertexAttribPointer(4,1,o.FLOAT,!1,T,8*d),o.enableVertexAttribArray(4),o.vertexAttribDivisor(4,1)}};g(rt,"vertices",new Float32Array([-.5,.5,.5,.5,-.5,-.5,.5,-.5])),g(rt,"indices",new Uint16Array([0,1,2,2,1,3])),g(rt,"vertex_count",rt.vertices.length/2),g(rt,"index_count",rt.indices.length);let at=rt;var Tr={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(s,o,c,a){var l=["","webkit","Moz","MS","ms","o"],d=o.createElement("div"),p="function",T=Math.round,f=Math.abs,E=Date.now;function O(e,r,i){return setTimeout(q(e,i),r)}function P(e,r,i){return Array.isArray(e)?(N(e,i[r],i),!0):!1}function N(e,r,i){var n;if(e)if(e.forEach)e.forEach(r,i);else if(e.length!==a)for(n=0;n<e.length;)r.call(i,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&r.call(i,e[n],n,e)}function C(e,r,i){var n="DEPRECATED METHOD: "+r+`
`+i+` AT 
`;return function(){var h=new Error("get-stack-trace"),u=h&&h.stack?h.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",v=s.console&&(s.console.warn||s.console.log);return v&&v.call(s.console,n,u),e.apply(this,arguments)}}var _;typeof Object.assign!="function"?_=function(r){if(r===a||r===null)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(r),n=1;n<arguments.length;n++){var h=arguments[n];if(h!==a&&h!==null)for(var u in h)h.hasOwnProperty(u)&&(i[u]=h[u])}return i}:_=Object.assign;var m=C(function(r,i,n){for(var h=Object.keys(i),u=0;u<h.length;)(!n||n&&r[h[u]]===a)&&(r[h[u]]=i[h[u]]),u++;return r},"extend","Use `assign`."),D=C(function(r,i){return m(r,i,!0)},"merge","Use `assign`.");function I(e,r,i){var n=r.prototype,h;h=e.prototype=Object.create(n),h.constructor=e,h._super=n,i&&_(h,i)}function q(e,r){return function(){return e.apply(r,arguments)}}function y(e,r){return typeof e==p?e.apply(r&&r[0]||a,r):e}function J(e,r){return e===a?r:e}function X(e,r,i){N(W(r),function(n){e.addEventListener(n,i,!1)})}function G(e,r,i){N(W(r),function(n){e.removeEventListener(n,i,!1)})}function $(e,r){for(;e;){if(e==r)return!0;e=e.parentNode}return!1}function F(e,r){return e.indexOf(r)>-1}function W(e){return e.trim().split(/\s+/g)}function w(e,r,i){if(e.indexOf&&!i)return e.indexOf(r);for(var n=0;n<e.length;){if(i&&e[n][i]==r||!i&&e[n]===r)return n;n++}return-1}function z(e){return Array.prototype.slice.call(e,0)}function K(e,r,i){for(var n=[],h=[],u=0;u<e.length;){var v=e[u][r];w(h,v)<0&&n.push(e[u]),h[u]=v,u++}return n=n.sort(function(M,L){return M[r]>L[r]}),n}function A(e,r){for(var i,n,h=r[0].toUpperCase()+r.slice(1),u=0;u<l.length;){if(i=l[u],n=i?i+h:r,n in e)return n;u++}return a}var ge=1;function _e(){return ge++}function kt(e){var r=e.ownerDocument||e;return r.defaultView||r.parentWindow||s}var Ae=/mobile|tablet|ip(ad|hone|od)|android/i,qt="ontouchstart"in s,Pe=A(s,"PointerEvent")!==a,Ne=qt&&Ae.test(navigator.userAgent),lt="touch",Ie="pen",Lt="mouse",Se="kinect",Oe=25,U=1,st=2,S=4,x=8,gt=1,ut=2,ft=4,dt=8,vt=16,B=ut|ft,nt=dt|vt,yt=B|nt,jt=["x","y"],_t=["clientX","clientY"];function b(e,r){var i=this;this.manager=e,this.callback=r,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(n){y(e.options.enable,[e])&&i.handler(n)},this.init()}b.prototype={handler:function(){},init:function(){this.evEl&&X(this.element,this.evEl,this.domHandler),this.evTarget&&X(this.target,this.evTarget,this.domHandler),this.evWin&&X(kt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&G(this.element,this.evEl,this.domHandler),this.evTarget&&G(this.target,this.evTarget,this.domHandler),this.evWin&&G(kt(this.element),this.evWin,this.domHandler)}};function Re(e){var r,i=e.options.inputClass;return i?r=i:Pe?r=Ft:Ne?r=Nt:qt?r=wt:r=Pt,new r(e,Ce)}function Ce(e,r,i){var n=i.pointers.length,h=i.changedPointers.length,u=r&U&&n-h===0,v=r&(S|x)&&n-h===0;i.isFirst=!!u,i.isFinal=!!v,u&&(e.session={}),i.eventType=r,De(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function De(e,r){var i=e.session,n=r.pointers,h=n.length;i.firstInput||(i.firstInput=Zt(r)),h>1&&!i.firstMultiple?i.firstMultiple=Zt(r):h===1&&(i.firstMultiple=!1);var u=i.firstInput,v=i.firstMultiple,R=v?v.center:u.center,M=r.center=Qt(n);r.timeStamp=E(),r.deltaTime=r.timeStamp-u.timeStamp,r.angle=xt(R,M),r.distance=At(R,M),Me(i,r),r.offsetDirection=$t(r.deltaX,r.deltaY);var L=Jt(r.deltaTime,r.deltaX,r.deltaY);r.overallVelocityX=L.x,r.overallVelocityY=L.y,r.overallVelocity=f(L.x)>f(L.y)?L.x:L.y,r.scale=v?xe(v.pointers,n):1,r.rotation=v?Le(v.pointers,n):0,r.maxPointers=i.prevInput?r.pointers.length>i.prevInput.maxPointers?r.pointers.length:i.prevInput.maxPointers:r.pointers.length,Ue(i,r);var k=e.element;$(r.srcEvent.target,k)&&(k=r.srcEvent.target),r.target=k}function Me(e,r){var i=r.center,n=e.offsetDelta||{},h=e.prevDelta||{},u=e.prevInput||{};(r.eventType===U||u.eventType===S)&&(h=e.prevDelta={x:u.deltaX||0,y:u.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),r.deltaX=h.x+(i.x-n.x),r.deltaY=h.y+(i.y-n.y)}function Ue(e,r){var i=e.lastInterval||r,n=r.timeStamp-i.timeStamp,h,u,v,R;if(r.eventType!=x&&(n>Oe||i.velocity===a)){var M=r.deltaX-i.deltaX,L=r.deltaY-i.deltaY,k=Jt(n,M,L);u=k.x,v=k.y,h=f(k.x)>f(k.y)?k.x:k.y,R=$t(M,L),e.lastInterval=r}else h=i.velocity,u=i.velocityX,v=i.velocityY,R=i.direction;r.velocity=h,r.velocityX=u,r.velocityY=v,r.direction=R}function Zt(e){for(var r=[],i=0;i<e.pointers.length;)r[i]={clientX:T(e.pointers[i].clientX),clientY:T(e.pointers[i].clientY)},i++;return{timeStamp:E(),pointers:r,center:Qt(r),deltaX:e.deltaX,deltaY:e.deltaY}}function Qt(e){var r=e.length;if(r===1)return{x:T(e[0].clientX),y:T(e[0].clientY)};for(var i=0,n=0,h=0;h<r;)i+=e[h].clientX,n+=e[h].clientY,h++;return{x:T(i/r),y:T(n/r)}}function Jt(e,r,i){return{x:r/e||0,y:i/e||0}}function $t(e,r){return e===r?gt:f(e)>=f(r)?e<0?ut:ft:r<0?dt:vt}function At(e,r,i){i||(i=jt);var n=r[i[0]]-e[i[0]],h=r[i[1]]-e[i[1]];return Math.sqrt(n*n+h*h)}function xt(e,r,i){i||(i=jt);var n=r[i[0]]-e[i[0]],h=r[i[1]]-e[i[1]];return Math.atan2(h,n)*180/Math.PI}function Le(e,r){return xt(r[1],r[0],_t)+xt(e[1],e[0],_t)}function xe(e,r){return At(r[0],r[1],_t)/At(e[0],e[1],_t)}var Fe={mousedown:U,mousemove:st,mouseup:S},we="mousedown",be="mousemove mouseup";function Pt(){this.evEl=we,this.evWin=be,this.pressed=!1,b.apply(this,arguments)}I(Pt,b,{handler:function(r){var i=Fe[r.type];i&U&&r.button===0&&(this.pressed=!0),i&st&&r.which!==1&&(i=S),this.pressed&&(i&S&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[r],changedPointers:[r],pointerType:Lt,srcEvent:r}))}});var He={pointerdown:U,pointermove:st,pointerup:S,pointercancel:x,pointerout:x},Ye={2:lt,3:Ie,4:Lt,5:Se},Kt="pointerdown",te="pointermove pointerup pointercancel";s.MSPointerEvent&&!s.PointerEvent&&(Kt="MSPointerDown",te="MSPointerMove MSPointerUp MSPointerCancel");function Ft(){this.evEl=Kt,this.evWin=te,b.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}I(Ft,b,{handler:function(r){var i=this.store,n=!1,h=r.type.toLowerCase().replace("ms",""),u=He[h],v=Ye[r.pointerType]||r.pointerType,R=v==lt,M=w(i,r.pointerId,"pointerId");u&U&&(r.button===0||R)?M<0&&(i.push(r),M=i.length-1):u&(S|x)&&(n=!0),!(M<0)&&(i[M]=r,this.callback(this.manager,u,{pointers:i,changedPointers:[r],pointerType:v,srcEvent:r}),n&&i.splice(M,1))}});var Xe={touchstart:U,touchmove:st,touchend:S,touchcancel:x},Ge="touchstart",We="touchstart touchmove touchend touchcancel";function ee(){this.evTarget=Ge,this.evWin=We,this.started=!1,b.apply(this,arguments)}I(ee,b,{handler:function(r){var i=Xe[r.type];if(i===U&&(this.started=!0),!!this.started){var n=ze.call(this,r,i);i&(S|x)&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,i,{pointers:n[0],changedPointers:n[1],pointerType:lt,srcEvent:r})}}});function ze(e,r){var i=z(e.touches),n=z(e.changedTouches);return r&(S|x)&&(i=K(i.concat(n),"identifier")),[i,n]}var Be={touchstart:U,touchmove:st,touchend:S,touchcancel:x},Ve="touchstart touchmove touchend touchcancel";function Nt(){this.evTarget=Ve,this.targetIds={},b.apply(this,arguments)}I(Nt,b,{handler:function(r){var i=Be[r.type],n=ke.call(this,r,i);n&&this.callback(this.manager,i,{pointers:n[0],changedPointers:n[1],pointerType:lt,srcEvent:r})}});function ke(e,r){var i=z(e.touches),n=this.targetIds;if(r&(U|st)&&i.length===1)return n[i[0].identifier]=!0,[i,i];var h,u,v=z(e.changedTouches),R=[],M=this.target;if(u=i.filter(function(L){return $(L.target,M)}),r===U)for(h=0;h<u.length;)n[u[h].identifier]=!0,h++;for(h=0;h<v.length;)n[v[h].identifier]&&R.push(v[h]),r&(S|x)&&delete n[v[h].identifier],h++;if(R.length)return[K(u.concat(R),"identifier"),R]}var qe=2500,re=25;function wt(){b.apply(this,arguments);var e=q(this.handler,this);this.touch=new Nt(this.manager,e),this.mouse=new Pt(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}I(wt,b,{handler:function(r,i,n){var h=n.pointerType==lt,u=n.pointerType==Lt;if(!(u&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(h)ye.call(this,i,n);else if(u&&je.call(this,n))return;this.callback(r,i,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ye(e,r){e&U?(this.primaryTouch=r.changedPointers[0].identifier,ie.call(this,r)):e&(S|x)&&ie.call(this,r)}function ie(e){var r=e.changedPointers[0];if(r.identifier===this.primaryTouch){var i={x:r.clientX,y:r.clientY};this.lastTouches.push(i);var n=this.lastTouches,h=function(){var u=n.indexOf(i);u>-1&&n.splice(u,1)};setTimeout(h,qe)}}function je(e){for(var r=e.srcEvent.clientX,i=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var h=this.lastTouches[n],u=Math.abs(r-h.x),v=Math.abs(i-h.y);if(u<=re&&v<=re)return!0}return!1}var se=A(d.style,"touchAction"),ne=se!==a,oe="compute",ae="auto",bt="manipulation",ot="none",Tt="pan-x",pt="pan-y",It=Qe();function Ht(e,r){this.manager=e,this.set(r)}Ht.prototype={set:function(e){e==oe&&(e=this.compute()),ne&&this.manager.element.style&&It[e]&&(this.manager.element.style[se]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return N(this.manager.recognizers,function(r){y(r.options.enable,[r])&&(e=e.concat(r.getTouchAction()))}),Ze(e.join(" "))},preventDefaults:function(e){var r=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented){r.preventDefault();return}var n=this.actions,h=F(n,ot)&&!It[ot],u=F(n,pt)&&!It[pt],v=F(n,Tt)&&!It[Tt];if(h){var R=e.pointers.length===1,M=e.distance<2,L=e.deltaTime<250;if(R&&M&&L)return}if(!(v&&u)&&(h||u&&i&B||v&&i&nt))return this.preventSrc(r)},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function Ze(e){if(F(e,ot))return ot;var r=F(e,Tt),i=F(e,pt);return r&&i?ot:r||i?r?Tt:pt:F(e,bt)?bt:ae}function Qe(){if(!ne)return!1;var e={},r=s.CSS&&s.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){e[i]=r?s.CSS.supports("touch-action",i):!0}),e}var St=1,H=2,ht=4,tt=8,j=tt,Et=16,V=32;function Z(e){this.options=_({},this.defaults,e||{}),this.id=_e(),this.manager=null,this.options.enable=J(this.options.enable,!0),this.state=St,this.simultaneous={},this.requireFail=[]}Z.prototype={defaults:{},set:function(e){return _(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(P(e,"recognizeWith",this))return this;var r=this.simultaneous;return e=Ot(e,this),r[e.id]||(r[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return P(e,"dropRecognizeWith",this)?this:(e=Ot(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(P(e,"requireFailure",this))return this;var r=this.requireFail;return e=Ot(e,this),w(r,e)===-1&&(r.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(P(e,"dropRequireFailure",this))return this;e=Ot(e,this);var r=w(this.requireFail,e);return r>-1&&this.requireFail.splice(r,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var r=this,i=this.state;function n(h){r.manager.emit(h,e)}i<tt&&n(r.options.event+he(i)),n(r.options.event),e.additionalEvent&&n(e.additionalEvent),i>=tt&&n(r.options.event+he(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=V},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(V|St)))return!1;e++}return!0},recognize:function(e){var r=_({},e);if(!y(this.options.enable,[this,r])){this.reset(),this.state=V;return}this.state&(j|Et|V)&&(this.state=St),this.state=this.process(r),this.state&(H|ht|tt|Et)&&this.tryEmit(r)},process:function(e){},getTouchAction:function(){},reset:function(){}};function he(e){return e&Et?"cancel":e&tt?"end":e&ht?"move":e&H?"start":""}function ce(e){return e==vt?"down":e==dt?"up":e==ut?"left":e==ft?"right":""}function Ot(e,r){var i=r.manager;return i?i.get(e):e}function Y(){Z.apply(this,arguments)}I(Y,Z,{defaults:{pointers:1},attrTest:function(e){var r=this.options.pointers;return r===0||e.pointers.length===r},process:function(e){var r=this.state,i=e.eventType,n=r&(H|ht),h=this.attrTest(e);return n&&(i&x||!h)?r|Et:n||h?i&S?r|tt:r&H?r|ht:H:V}});function Rt(){Y.apply(this,arguments),this.pX=null,this.pY=null}I(Rt,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:yt},getTouchAction:function(){var e=this.options.direction,r=[];return e&B&&r.push(pt),e&nt&&r.push(Tt),r},directionTest:function(e){var r=this.options,i=!0,n=e.distance,h=e.direction,u=e.deltaX,v=e.deltaY;return h&r.direction||(r.direction&B?(h=u===0?gt:u<0?ut:ft,i=u!=this.pX,n=Math.abs(e.deltaX)):(h=v===0?gt:v<0?dt:vt,i=v!=this.pY,n=Math.abs(e.deltaY))),e.direction=h,i&&n>r.threshold&&h&r.direction},attrTest:function(e){return Y.prototype.attrTest.call(this,e)&&(this.state&H||!(this.state&H)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var r=ce(e.direction);r&&(e.additionalEvent=this.options.event+r),this._super.emit.call(this,e)}});function Yt(){Y.apply(this,arguments)}I(Yt,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ot]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&H)},emit:function(e){if(e.scale!==1){var r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}this._super.emit.call(this,e)}});function Xt(){Z.apply(this,arguments),this._timer=null,this._input=null}I(Xt,Z,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ae]},process:function(e){var r=this.options,i=e.pointers.length===r.pointers,n=e.distance<r.threshold,h=e.deltaTime>r.time;if(this._input=e,!n||!i||e.eventType&(S|x)&&!h)this.reset();else if(e.eventType&U)this.reset(),this._timer=O(function(){this.state=j,this.tryEmit()},r.time,this);else if(e.eventType&S)return j;return V},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===j&&(e&&e.eventType&S?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=E(),this.manager.emit(this.options.event,this._input)))}});function Gt(){Y.apply(this,arguments)}I(Gt,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ot]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&H)}});function Wt(){Y.apply(this,arguments)}I(Wt,Y,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:B|nt,pointers:1},getTouchAction:function(){return Rt.prototype.getTouchAction.call(this)},attrTest:function(e){var r=this.options.direction,i;return r&(B|nt)?i=e.overallVelocity:r&B?i=e.overallVelocityX:r&nt&&(i=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(i)>this.options.velocity&&e.eventType&S},emit:function(e){var r=ce(e.offsetDirection);r&&this.manager.emit(this.options.event+r,e),this.manager.emit(this.options.event,e)}});function Ct(){Z.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}I(Ct,Z,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[bt]},process:function(e){var r=this.options,i=e.pointers.length===r.pointers,n=e.distance<r.threshold,h=e.deltaTime<r.time;if(this.reset(),e.eventType&U&&this.count===0)return this.failTimeout();if(n&&h&&i){if(e.eventType!=S)return this.failTimeout();var u=this.pTime?e.timeStamp-this.pTime<r.interval:!0,v=!this.pCenter||At(this.pCenter,e.center)<r.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,!v||!u?this.count=1:this.count+=1,this._input=e;var R=this.count%r.taps;if(R===0)return this.hasRequireFailures()?(this._timer=O(function(){this.state=j,this.tryEmit()},r.interval,this),H):j}return V},failTimeout:function(){return this._timer=O(function(){this.state=V},this.options.interval,this),V},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==j&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function et(e,r){return r=r||{},r.recognizers=J(r.recognizers,et.defaults.preset),new zt(e,r)}et.VERSION="2.0.7",et.defaults={domEvents:!1,touchAction:oe,enable:!0,inputTarget:null,inputClass:null,preset:[[Gt,{enable:!1}],[Yt,{enable:!1},["rotate"]],[Wt,{direction:B}],[Rt,{direction:B},["swipe"]],[Ct],[Ct,{event:"doubletap",taps:2},["tap"]],[Xt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Je=1,le=2;function zt(e,r){this.options=_({},et.defaults,r||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=Re(this),this.touchAction=new Ht(this,this.options.touchAction),ue(this,!0),N(this.options.recognizers,function(i){var n=this.add(new i[0](i[1]));i[2]&&n.recognizeWith(i[2]),i[3]&&n.requireFailure(i[3])},this)}zt.prototype={set:function(e){return _(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?le:Je},recognize:function(e){var r=this.session;if(!r.stopped){this.touchAction.preventDefaults(e);var i,n=this.recognizers,h=r.curRecognizer;(!h||h&&h.state&j)&&(h=r.curRecognizer=null);for(var u=0;u<n.length;)i=n[u],r.stopped!==le&&(!h||i==h||i.canRecognizeWith(h))?i.recognize(e):i.reset(),!h&&i.state&(H|ht|tt)&&(h=r.curRecognizer=i),u++}},get:function(e){if(e instanceof Z)return e;for(var r=this.recognizers,i=0;i<r.length;i++)if(r[i].options.event==e)return r[i];return null},add:function(e){if(P(e,"add",this))return this;var r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(P(e,"remove",this))return this;if(e=this.get(e),e){var r=this.recognizers,i=w(r,e);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this},on:function(e,r){if(e!==a&&r!==a){var i=this.handlers;return N(W(e),function(n){i[n]=i[n]||[],i[n].push(r)}),this}},off:function(e,r){if(e!==a){var i=this.handlers;return N(W(e),function(n){r?i[n]&&i[n].splice(w(i[n],r),1):delete i[n]}),this}},emit:function(e,r){this.options.domEvents&&$e(e,r);var i=this.handlers[e]&&this.handlers[e].slice();if(!(!i||!i.length)){r.type=e,r.preventDefault=function(){r.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](r),n++}},destroy:function(){this.element&&ue(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ue(e,r){var i=e.element;if(i.style){var n;N(e.options.cssProps,function(h,u){n=A(i.style,u),r?(e.oldCssProps[n]=i.style[n],i.style[n]=h):i.style[n]=e.oldCssProps[n]||""}),r||(e.oldCssProps={})}}function $e(e,r){var i=o.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=r,r.target.dispatchEvent(i)}_(et,{INPUT_START:U,INPUT_MOVE:st,INPUT_END:S,INPUT_CANCEL:x,STATE_POSSIBLE:St,STATE_BEGAN:H,STATE_CHANGED:ht,STATE_ENDED:tt,STATE_RECOGNIZED:j,STATE_CANCELLED:Et,STATE_FAILED:V,DIRECTION_NONE:gt,DIRECTION_LEFT:ut,DIRECTION_RIGHT:ft,DIRECTION_UP:dt,DIRECTION_DOWN:vt,DIRECTION_HORIZONTAL:B,DIRECTION_VERTICAL:nt,DIRECTION_ALL:yt,Manager:zt,Input:b,TouchAction:Ht,TouchInput:Nt,MouseInput:Pt,PointerEventInput:Ft,TouchMouseInput:wt,SingleTouchInput:ee,Recognizer:Z,AttrRecognizer:Y,Tap:Ct,Pan:Rt,Swipe:Wt,Pinch:Yt,Rotate:Gt,Press:Xt,on:X,off:G,each:N,merge:D,extend:m,assign:_,inherit:I,bindFn:q,prefixed:A});var Ke=typeof s<"u"?s:typeof self<"u"?self:{};Ke.Hammer=et,t.exports?t.exports=et:s[c]=et})(window,document,"Hammer")})(Tr);const ve={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,ARROWLEFT:37,ARROWUP:38,ARROWRIGHT:39,ARROWDOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOWS:91,"RIGHT CLICK":93,"NUMPAD 0":96,"NUMPAD 1":97,"NUMPAD 2":98,"NUMPAD 3":99,"NUMPAD 4":100,"NUMPAD 5":101,"NUMPAD 6":102,"NUMPAD 7":103,"NUMPAD 8":104,"NUMPAD 9":105,"NUMPAD *":106,"NUMPAD +":107,"NUMPAD -":109,"NUMPAD .":110,"NUMPAD /":111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"NUM LOCK":144,"SCROLL LOCK":145,"MY COMPUTER":182,"MY CALCULATOR":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};var ct=(t=>(t[t.BACKSPACE=8]="BACKSPACE",t[t.TAB=9]="TAB",t[t.ENTER=13]="ENTER",t[t.SHIFT=16]="SHIFT",t[t.CTRL=17]="CTRL",t[t.ALT=18]="ALT",t[t.PAUSEBREAK=19]="PAUSEBREAK",t[t.CAPSLOCK=20]="CAPSLOCK",t[t.ESC=27]="ESC",t[t.SPACE=32]="SPACE",t[t.PAGEUP=33]="PAGEUP",t[t.PAGEDOWN=34]="PAGEDOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.INSERT=45]="INSERT",t[t.DELETE=46]="DELETE",t[t.ZERO=48]="ZERO",t[t.ONE=49]="ONE",t[t.TWO=50]="TWO",t[t.THREE=51]="THREE",t[t.FOUR=52]="FOUR",t[t.FIVE=53]="FIVE",t[t.SIX=54]="SIX",t[t.SEVEN=55]="SEVEN",t[t.EIGHT=56]="EIGHT",t[t.NINE=57]="NINE",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.WINDOWS=91]="WINDOWS",t[t.RIGHTCLICK=93]="RIGHTCLICK",t[t.NUMPAD0=96]="NUMPAD0",t[t.NUMPAD1=97]="NUMPAD1",t[t.NUMPAD2=98]="NUMPAD2",t[t.NUMPAD3=99]="NUMPAD3",t[t.NUMPAD4=100]="NUMPAD4",t[t.NUMPAD5=101]="NUMPAD5",t[t.NUMPAD6=102]="NUMPAD6",t[t.NUMPAD7=103]="NUMPAD7",t[t.NUMPAD8=104]="NUMPAD8",t[t.NUMPAD9=105]="NUMPAD9",t[t.NUMPADMUL=106]="NUMPADMUL",t[t.NUMPADADD=107]="NUMPADADD",t[t.NUMPADSUB=109]="NUMPADSUB",t[t.NUMPADDOT=110]="NUMPADDOT",t[t.NUMPADSLASH=111]="NUMPADSLASH",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NUMLOCK=144]="NUMLOCK",t[t.SCROLLLOCK=145]="SCROLLLOCK",t[t.MYCOMPUTER=182]="MYCOMPUTER",t[t.MYCALCULATOR=183]="MYCALCULATOR",t[t.SEMICOLON=186]="SEMICOLON",t[t.EQUAL=187]="EQUAL",t[t.COMMA=188]="COMMA",t[t.DASH=189]="DASH",t[t.DOT=190]="DOT",t[t.SLASH=191]="SLASH",t[t.BACKTICK=192]="BACKTICK",t[t.LEFTSQRBRACKET=219]="LEFTSQRBRACKET",t[t.BACKSLASH=220]="BACKSLASH",t[t.RIGHTSQRBRACKET=221]="RIGHTSQRBRACKET",t[t.SINGLEQUOTE=222]="SINGLEQUOTE",t))(ct||{});class pr{constructor(){g(this,"state");g(this,"mouse");g(this,"raf_id");this.state={},this.mouse={left:!1,middle:!1,right:!1,wheel:{x:0,y:0,z:0},pos:[0,0]},this.raf_id=null,document.addEventListener("keydown",a=>this.handle_key(a,!0)),document.addEventListener("keyup",a=>this.handle_key(a,!1)),document.addEventListener("mousedown",a=>this._mousedown(a,!0)),document.addEventListener("mouseup",a=>this._mousedown(a,!1)),document.addEventListener("wheel",a=>this.wheel(a)),document.addEventListener("mousemove",a=>this._mousemove(a)),document.addEventListener("touchstart",a=>{this.mouse.left=!0,this.mouse.pos=[a.touches[0].pageX,a.touches[0].pageY]}),document.addEventListener("touchmove",a=>{this.mouse.pos=[a.touches[0].pageX,a.touches[0].pageY]}),document.addEventListener("touchend",()=>{this.mouse.left=!1});const s=document.getElementById("app");if(!s)throw new Error;const o=new Hammer(s),c=new Hammer.Pinch;o.add([c]),o.on("pinch",a=>{lr(`${a.deltaX}, ${a.deltaY}`)})}keydown(s){return this.state[s]}_mousedown(s,o){const c=o||s.type==="mousedown";this.mouse.left=s.button===0&&c,this.mouse.middle=s.button===1&&c,this.mouse.right=s.button===2&&c}_mousemove(s){this.mouse.pos[0]=s.x,this.mouse.pos[1]=s.y}wheel(s){this.mouse.wheel.x=s.deltaX,this.mouse.wheel.y=s.deltaY,this.mouse.wheel.z=s.deltaZ,this.raf_id||(this.raf_id=requestAnimationFrame(()=>{this.mouse.wheel.x=0,this.mouse.wheel.y=0,this.mouse.wheel.z=0,this.raf_id=null}))}handle_key(s,o){s.key.toUpperCase()in ve||it(`Unhandled key: ${s.key.toUpperCase()}`),this.state[ve[s.key.toUpperCase()]]=o||s.type==="keydown"}}class Er{constructor(s,o,c){g(this,"width");g(this,"height");g(this,"pos");g(this,"zoom");g(this,"speed");g(this,"projection_matrix");g(this,"start_drag");g(this,"offset");this.width=s,this.height=o,this.pos=[0,0],this.zoom=1,this.speed=c||500,this.projection_matrix=Mt(),this.start_drag=null,this.offset=[0,0]}handle_zoom(s){this.zoom+=-Math.sign(s.mouse.wheel.y)*(this.zoom*.6),this.zoom=Math.min(Math.max(this.zoom,.1),10);const o=fe(this,s.mouse.pos);this.update_projection_matrix();const c=fe(this,s.mouse.pos);this.pos[0]+=o[0]-c[0],this.pos[1]+=o[1]-c[1]}handle_drag(s){this.start_drag&&(this.offset[0]=(this.start_drag[0]-s.mouse.pos[0])/this.zoom,this.offset[1]=(this.start_drag[1]-s.mouse.pos[1])/this.zoom)}update(s,o){let c=1/this.zoom*2*this.speed*o;s.keydown(ct.SHIFT)&&(c*=5),s.keydown(ct.W)&&(this.pos[1]+=-c),s.keydown(ct.A)&&(this.pos[0]+=-c),s.keydown(ct.S)&&(this.pos[1]+=c),s.keydown(ct.D)&&(this.pos[0]+=c),s.mouse.left&&this.start_drag===null?this.start_drag=[...s.mouse.pos]:s.mouse.left&&this.start_drag?this.handle_drag(s):!s.mouse.left&&this.start_drag&&(this.start_drag=null,this.pos[0]+=this.offset[0],this.pos[1]+=this.offset[1],this.offset=[0,0]),s.mouse.wheel.y&&this.handle_zoom(s),this.update_projection_matrix()}update_projection_matrix(){const s=Mt(),o=this.pos[0]+this.offset[0],c=this.pos[0]+this.offset[0]+this.width/this.zoom,a=this.pos[1]+this.offset[1],l=this.pos[1]+this.offset[1]+this.height/this.zoom;ar(s,o,c,l,a,-1,1),this.projection_matrix=s}}class mr extends me{constructor(o){super();g(this,"src");g(this,"texture");this.src=o,this.texture=this.load_texture(o)}load_texture(o){const c=this.gl.createTexture();if(!c)throw new Error;this.gl.bindTexture(this.gl.TEXTURE_2D,c),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);const a=new Image;return a.src=o,a.onload=()=>{this.gl.bindTexture(this.gl.TEXTURE_2D,c),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.generateMipmap(this.gl.TEXTURE_2D)},c}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)}delete(){this.gl.deleteTexture(this.texture)}}(async()=>{const t=Vt(),s=document.querySelector("#app"),o=s==null?void 0:s.querySelector("canvas");if(!o)return;o.width=window.innerWidth,o.height=window.innerHeight;const c=new fr([{id:"default",type:Ut.FRAGMENT,source:dr},{id:"default",type:Ut.VERTEX,source:vr}]);c.bind();const a=await fetch("note_atlas.json").then(async m=>await m.json()),l=m=>{const D=m%a.tex_in_row*a.tex_size[0],I=Math.floor(m/a.tex_in_row)*a.tex_size[1];return[D/a.size[0],I/a.size[1],(D+a.tex_size[0])/a.size[0],(I+a.tex_size[1])/a.size[1]]},d=new mr("note_atlas.png"),p=new pr,T=new Er(o.width,o.height),f=[],E=32;for(let m=0;m<100;m++)f.push(new at([m*E,m*E],[E,E],l(m%a.tex_count)));const O=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,O),t.bufferData(t.ARRAY_BUFFER,at.vertices,t.STATIC_DRAW);const P=Float32Array.BYTES_PER_ELEMENT;t.vertexAttribPointer(0,2,t.FLOAT,!1,2*P,0),t.enableVertexAttribArray(0);const N=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,N),t.bufferData(t.ELEMENT_ARRAY_BUFFER,at.indices,t.STATIC_DRAW),at.setup_instanced_attributes(t,f);let C=-1;const _=m=>{if(!t)return;const D=C>0?(m-C)/1e3:1;C=m,t.clearColor(30/255,30/255,30/255,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),T.update(p,D),t.uniformMatrix4fv(c.get_uniform("projection"),!1,T.projection_matrix),d.bind(),t.drawElementsInstanced(t.TRIANGLES,at.index_count,t.UNSIGNED_SHORT,0,f.length),requestAnimationFrame(_)};t.viewport(0,0,o.width,o.height),requestAnimationFrame(_)})();
